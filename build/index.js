!function(e){var r={};function t(n){if(r[n])return r[n].exports;var o=r[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,t),o.l=!0,o.exports}t.m=e,t.c=r,t.d=function(e,r,n){t.o(e,r)||Object.defineProperty(e,r,{enumerable:!0,get:n})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,r){if(1&r&&(e=t(e)),8&r)return e;if(4&r&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(t.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&r&&"string"!=typeof e)for(var o in e)t.d(n,o,function(r){return e[r]}.bind(null,o));return n},t.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(r,"a",r),r},t.o=function(e,r){return Object.prototype.hasOwnProperty.call(e,r)},t.p="",t(t.s=4)}([function(e,r){e.exports=require("jsonwebtoken")},function(e,r){e.exports=require("bcryptjs")},function(e,r){e.exports=require("graphql-yoga")},function(e,r){e.exports=require("prisma-binding")},function(e,r,t){"use strict";t.r(r);var n=t(2),o=t(3);var i={feed:async(e,r,t)=>{const{db:n}=t,o=r.filter?{OR:[{url_contains:r.filter},{description_contains:r.filter}]}:{},i=await n.query.links({where:o,skip:r.skip,first:r.first,orderBy:r.orderBy},"{id}");return{count:(await n.query.linksConnection({},"\n    {\n      aggregate {\n        count\n      }\n    }\n  ")).aggregate.count,linkIds:i.map(e=>e.id)}}},s=t(1),a=t.n(s),u=t(0),c=t.n(u);const d=e=>{const{request:r}=e,t=r.get("Authorization");if(t){const e=t.replace("Bearer ",""),{userId:r}=c.a.verify(e,"GraphQL-is-aw3some");return r}throw new Error("Not authenticated")};const l={Query:i,Mutation:{signup:async(e,r,t)=>{const n=await a.a.hash(r.password,10),{db:o}=t,i=await o.mutation.createUser({data:{...r,password:n}},"{ id }");return{token:c.a.sign({userId:i.id},"GraphQL-is-aw3some"),user:i}},login:async(e,r,t)=>{const{db:n}=t,o=await n.query.user({where:{email:r.email}},"{ id password }");if(!o)throw new Error("No such user found");if(!await a.a.compare(r.password,o.password))throw new Error("Invalid password");return{token:c.a.sign({userId:o.id},"GraphQL-is-aw3some"),user:o}},post:(e,r,t,n)=>{const o=d(t),{db:i}=t;return i.mutation.createLink({data:{url:r.url,description:r.description,postedBy:{connect:{id:o}}}},n)},vote:async(e,r,t,n)=>{const{db:o}=t,i=d(t);if(await o.exists.Vote({user:{id:i},link:{id:r.linkId}}))throw new Error(`Already voted for link: ${r.linkId}`);return o.mutation.createVote({data:{user:{connect:{id:i}},link:{connect:{id:r.linkId}}}},n)}},AuthPayload:{user:(e,r,t,n)=>{const{db:o}=t;return o.query.user({where:{id:e.user.id}},n)}},Subscription:{newLink:{subscribe:(e,r,t,n)=>{const{db:o}=t;return o.subscription.link({where:{mutation_in:["CREATED"]}},n)}},newVote:{subscribe:(e,r,t,n)=>{const{db:o}=t;return o.subscription.vote({where:{mutation_in:["CREATED"]}},n)}}},Feed:{links:(e,r,t,n)=>{const{db:o}=t;return o.query.links({where:{id_in:e.linkIds}},n)}}};new n.GraphQLServer({typeDefs:"./src/schema.graphql",resolvers:l,resolverValidationOptions:{requireResolversForResolveType:!1},context:e=>({...e,db:new o.Prisma({typeDefs:"./src/generated/prisma.graphql",endpoint:"https://us1.prisma.sh/nikhil-arora-eecdb7/hackernews-clone/prod",secret:"mysecret123",debug:!0})})}).start(()=>{console.log("Server is running on http://localhost:4000")})}]);